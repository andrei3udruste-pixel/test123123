<mat-card class="w-full">
  <mat-card-title>
    <p class="p-5 text-2xl md:text-3xl">{{ 'user.list.title' | translate }}</p>
  </mat-card-title>

  <mat-card-content>

    <mat-accordion class="block mb-4">
      <mat-expansion-panel>
        <mat-expansion-panel-header>
          <mat-panel-title>
            {{ 'actions.filter' | translate }}
          </mat-panel-title>
        </mat-expansion-panel-header>

        <form [formGroup]="filterForm" class="grid grid-cols-1 md:grid-cols-3 gap-2 pt-2">

          <mat-form-field appearance="outline" class="w-full">
            <mat-label>{{ 'user.username' | translate }}</mat-label>
            <input matInput formControlName="username" />
          </mat-form-field>

          <mat-form-field appearance="outline" class="w-full">
            <mat-label>{{ 'user.email' | translate }}</mat-label>
            <input matInput formControlName="email" />
          </mat-form-field>

          <mat-form-field appearance="outline" class="w-full">
            <mat-label>{{ 'user.id' | translate }}</mat-label>
            <input matInput formControlName="id" placeholder="UUID" />
          </mat-form-field>

          <mat-form-field appearance="outline" class="w-full">
            <mat-label>{{ 'user.enabled' | translate }}</mat-label>
            <mat-select formControlName="enabled">
              <mat-option [value]="null"></mat-option>
              <mat-option [value]="true">Enabled</mat-option>
              <mat-option [value]="false">Disabled</mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline" class="w-full">
            <mat-label>{{ 'user.locked' | translate }}</mat-label>
            <mat-select formControlName="locked">
              <mat-option [value]="null"></mat-option>
              <mat-option [value]="true">Locked</mat-option>
              <mat-option [value]="false">Unlocked</mat-option>
            </mat-select>
          </mat-form-field>

          <div class="col-span-1 md:col-span-3 flex gap-2 justify-end items-center">
            <button
              mat-flat-button
              color="primary"
              type="button"
              (click)="onSearch()">
              {{ 'actions.filter' | translate }}
            </button>

            <button
              mat-stroked-button
              type="button"
              (click)="clearFilters()">
              {{ 'actions.reset' | translate }}
            </button>
          </div>
        </form>

      </mat-expansion-panel>
    </mat-accordion>

    @if (isLoading()) {
      <div class="loading">
        <mat-progress-bar mode="indeterminate"></mat-progress-bar>
      </div>
    }



    <table mat-table [dataSource]="dataSource()" class="mat-elevation-z1 w-full rounded-lg overflow-hidden">

      <ng-container matColumnDef="id">
        <th mat-header-cell *matHeaderCellDef>
          {{ 'user.id' | translate }}
        </th>
        <td mat-cell *matCellDef="let u">
          {{ u.id }}
        </td>
      </ng-container>


      <ng-container matColumnDef="username">
        <th mat-header-cell *matHeaderCellDef>
          {{ 'user.username' | translate }}
        </th>
        <td mat-cell *matCellDef="let u">
          {{ u.username }}
        </td>
      </ng-container>


      <ng-container matColumnDef="email">
        <th mat-header-cell *matHeaderCellDef>
          {{ 'user.email' | translate }}
        </th>
        <td mat-cell *matCellDef="let u">
          {{ u.email }}
        </td>
      </ng-container>


      <ng-container matColumnDef="enabled">
        <th mat-header-cell *matHeaderCellDef>
          {{ 'user.enabled' | translate }}
        </th>
        <td mat-cell *matCellDef="let u">
          <mat-icon>
            {{ u.enabled ? 'check_circle' : 'cancel' }}
          </mat-icon>
        </td>
      </ng-container>

      <ng-container matColumnDef="locked">
        <th mat-header-cell *matHeaderCellDef>
          {{ 'user.locked' | translate }}
        </th>
        <td mat-cell *matCellDef="let u">
          <mat-icon>
            {{ u.locked ? 'lock' : 'lock_open' }}
          </mat-icon>
        </td>
      </ng-container>


      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>
          {{ 'list.actions' | translate }}
        </th>
        <td mat-cell *matCellDef="let u">
          <div class="flex gap-1">

          <button
            mat-icon-button
            matTooltip="Vizualizează utilizator"
            matTooltipPosition="above"
            [routerLink]="['/user', u.id, 'view']"
            class="rounded-full transition-all duration-150 hover:bg-white/10 hover:scale-110">
            <mat-icon>visibility</mat-icon>
          </button>


          <button
            mat-icon-button
            matTooltip="Editează utilizator"
            matTooltipPosition="above"
            [routerLink]="['/user', u.id, 'edit']"
            class="rounded-full transition-all duration-150 hover:bg-white/10 hover:scale-110">
            <mat-icon>edit</mat-icon>
          </button>


          <button
            mat-icon-button
            [matTooltip]="u.enabled ? 'Dezactivează utilizator' : 'Activează utilizator'"
            matTooltipPosition="above"
            (click)="toggleEnabled(u)"
            class="rounded-full transition-all duration-150 hover:bg-white/10 hover:scale-110">
            <mat-icon>
              {{ u.enabled ? 'person_off' : 'person' }}
            </mat-icon>
          </button>

          </div>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>


    <mat-paginator
      [length]="totalItems()"
      [pageIndex]="page()"
      [pageSize]="pageSize()"
      [pageSizeOptions]="pageSizeOptions"
      (page)="onPageChange($event)">
    </mat-paginator>

  </mat-card-content>
</mat-card>
