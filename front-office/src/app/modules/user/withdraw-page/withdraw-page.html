<mat-card class="max-w-xl mx-auto p-4">
  <mat-card-title>
    <p class="p-3 mb-1 text-3xl md:text-4xl">
      {{ 'withdrawal.title' | translate }}
    </p>
  </mat-card-title>

  <mat-card-content>

    @if (wallet) {
      <div class="flex flex-col gap-3 mb-6 text-sm">
        <div class="grid grid-cols-1 md:grid-cols-[140px_1fr] items-center gap-2">
          <span class="font-medium opacity-70">{{ 'wallet.balance' | translate }}</span>
          <span class="text-lg font-semibold">{{ wallet.balance | number:'1.2-2' }} {{ wallet.currency }}</span>
        </div>
      </div>
    }

    <form [formGroup]="form" (ngSubmit)="submit()" class="flex flex-col gap-4">

      <mat-form-field appearance="outline" class="w-full">
        <mat-label>{{ 'withdrawal.amount' | translate }}</mat-label>
        <input matInput type="number" formControlName="amount" min="1" step="0.01" />
        @if (form.get('amount')?.touched && form.get('amount')?.hasError('required')) {
          <mat-error>{{ 'withdrawal.amount' | translate }} is required</mat-error>
        }
        @if (form.get('amount')?.touched && form.get('amount')?.hasError('min')) {
          <mat-error>{{ 'withdrawal.amount' | translate }} must be greater than 0</mat-error>
        }
      </mat-form-field>

      <mat-form-field appearance="outline" class="w-full">
        <mat-label>{{ 'withdrawal.payoutMethod' | translate }}</mat-label>
        <mat-select formControlName="payoutMethod">
          <mat-option value="IBAN">IBAN</mat-option>
          <mat-option value="REVOLUT">Revolut</mat-option>
          <mat-option value="PAYPAL">PayPal</mat-option>
        </mat-select>
        @if (form.get('payoutMethod')?.touched && form.get('payoutMethod')?.hasError('required')) {
          <mat-error>{{ 'withdrawal.payoutMethod' | translate }} is required</mat-error>
        }
      </mat-form-field>

      <mat-form-field appearance="outline" class="w-full">
        <mat-label>{{ 'withdrawal.payoutDetails' | translate }}</mat-label>
        <input matInput type="text" formControlName="payoutDetails" [placeholder]="'withdrawal.payoutDetails.placeholder' | translate" />
        @if (form.get('payoutDetails')?.touched && form.get('payoutDetails')?.hasError('required')) {
          <mat-error>{{ 'withdrawal.payoutDetails' | translate }} is required</mat-error>
        }
      </mat-form-field>

      <div class="flex justify-end gap-3">
        <button
          mat-flat-button
          color="primary"
          type="submit"
          [disabled]="form.invalid">
          {{ 'withdrawal.submit' | translate }}
        </button>
      </div>

    </form>

    @if (withdrawals.length > 0) {
      <div class="mt-8">
        <h3 class="text-xl font-semibold mb-4">{{ 'withdrawal.menu' | translate }}</h3>

        <table mat-table [dataSource]="withdrawals" class="mat-elevation-z1 w-full rounded-lg overflow-hidden">

          <ng-container matColumnDef="createdAt">
            <th mat-header-cell *matHeaderCellDef>Date</th>
            <td mat-cell *matCellDef="let w">{{ w.createdAt | date: 'dd.MM.yyyy HH:mm' }}</td>
          </ng-container>

          <ng-container matColumnDef="amount">
            <th mat-header-cell *matHeaderCellDef>{{ 'withdrawal.amount' | translate }}</th>
            <td mat-cell *matCellDef="let w">{{ w.amount | number:'1.2-2' }}</td>
          </ng-container>

          <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef>Status</th>
            <td mat-cell *matCellDef="let w">
              <span [ngClass]="{
                'text-orange-500': w.status === 'PENDING',
                'text-blue-600': w.status === 'APPROVED',
                'text-green-600': w.status === 'PAID',
                'text-red-600': w.status === 'REJECTED'
              }" class="font-semibold uppercase">
                {{ ('withdrawal.status.' + w.status) | translate }}
              </span>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="['createdAt', 'amount', 'status']"></tr>
          <tr mat-row *matRowDef="let row; columns: ['createdAt', 'amount', 'status']"></tr>
        </table>
      </div>
    }

    @if (withdrawals.length === 0) {
      <div class="mt-8 text-gray-500">
        {{ 'withdrawal.empty' | translate }}
      </div>
    }

  </mat-card-content>
</mat-card>
