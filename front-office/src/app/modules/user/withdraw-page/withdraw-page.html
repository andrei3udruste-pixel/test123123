<mat-card class="w-full">
  <mat-card-title>
    <div class="flex justify-between items-center p-5">
      <p class="text-2xl md:text-3xl">{{ 'withdrawal.list.title' | translate }}</p>
      <button mat-flat-button color="primary" (click)="openAddDialog()">
        <mat-icon>add</mat-icon>
        {{ 'withdrawal.add.title' | translate }}
      </button>
    </div>
  </mat-card-title>

  <mat-card-content>

    @if (wallet) {
      <div class="flex items-center gap-4 mb-4 p-4 bg-gray-800/50 rounded-lg">
        <mat-icon class="text-green-500">account_balance_wallet</mat-icon>
        <div>
          <span class="text-sm opacity-70">{{ 'wallet.balance' | translate }}</span>
          <p class="text-xl font-semibold">{{ wallet.balance | number:'1.2-2' }} {{ wallet.currency }}</p>
        </div>
      </div>
    }

    @if (isLoading()) {
      <div class="loading">
        <mat-progress-bar mode="indeterminate"></mat-progress-bar>
      </div>
    }

    <table mat-table [dataSource]="withdrawals()" class="mat-elevation-z1 w-full rounded-lg overflow-hidden">

      <ng-container matColumnDef="createdAt">
        <th mat-header-cell *matHeaderCellDef>{{ 'withdrawal.createdAt' | translate }}</th>
        <td mat-cell *matCellDef="let w">{{ w.createdAt | date: 'dd.MM.yyyy HH:mm' }}</td>
      </ng-container>

      <ng-container matColumnDef="amount">
        <th mat-header-cell *matHeaderCellDef>{{ 'withdrawal.amount' | translate }} (Stakes)</th>
        <td mat-cell *matCellDef="let w">{{ w.amount | number:'1.2-2' }}</td>
      </ng-container>

      <ng-container matColumnDef="convertedAmount">
        <th mat-header-cell *matHeaderCellDef>{{ 'withdrawal.convertedAmount' | translate }}</th>
        <td mat-cell *matCellDef="let w">
          @if (w.convertedAmount && w.currencyCode) {
            {{ w.convertedAmount | number:'1.2-2' }} {{ w.currencyCode }}
          } @else {
            -
          }
        </td>
      </ng-container>

      <ng-container matColumnDef="payoutMethod">
        <th mat-header-cell *matHeaderCellDef>{{ 'withdrawal.payoutMethod' | translate }}</th>
        <td mat-cell *matCellDef="let w">{{ w.payoutMethod }}</td>
      </ng-container>

      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef>{{ 'withdrawal.statusLabel' | translate }}</th>
        <td mat-cell *matCellDef="let w">
          <span [ngClass]="{
            'text-orange-500': w.status === 'PENDING',
            'text-blue-500': w.status === 'APPROVED',
            'text-green-500': w.status === 'PAID',
            'text-red-500': w.status === 'REJECTED'
          }" class="font-semibold uppercase">
            {{ ('withdrawal.status.' + w.status) | translate }}
          </span>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>

      <tr class="mat-row" *matNoDataRow>
        <td class="mat-cell text-center py-8 opacity-60" [attr.colspan]="displayedColumns.length">
          {{ 'withdrawal.empty' | translate }}
        </td>
      </tr>
    </table>

    <mat-paginator
      [length]="totalItems()"
      [pageIndex]="page()"
      [pageSize]="pageSize()"
      [pageSizeOptions]="pageSizeOptions"
      (page)="onPageChange($event)">
    </mat-paginator>

  </mat-card-content>
</mat-card>
